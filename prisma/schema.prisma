generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model users {
  id                   Int                    @id @default(autoincrement())
  name                 String
  email                String                 @unique
  points               Int                    @default(0)
  completedTasks       Int                    @default(0)
  password             String?
  status               String                 @default("pending")
  weekHours            Float                  @default(0)
  createdAt            DateTime               @default(now())
  currentWeekHours     Float                  @default(0)
  roles                UserRole[]
  avatar               String?
  bio                  String?
  profileVisibility    ProfileVisibility      @default(public)
  createdBadges        badges[]               @relation("UserCreatedBadges")
  daily_logs           daily_logs[]           @relation("UserDailyLogs")
  history              history[]              @relation("UserHistory")
  assignedIssues       issues[]               @relation("UserAssignedIssues")
  reportedIssues       issues[]               @relation("UserReportedIssues")
  lab_events           lab_events[]           @relation("UserLabEvents")
  lab_responsibilities lab_responsibilities[] @relation("UserLabResponsibilities")
  projectMemberships   project_members[]      @relation("UserProjectMemberships")
  projects             projects[]             @relation("UserProjects")
  ledProjects          projects[]             @relation("UserProjectLeadership")
  purchases            purchases[]            @relation("UserPurchases")
  tasks                tasks[]                @relation("UserTasks")
  awardedBadges        user_badges[]          @relation("UserAwardedBadges")
  badges               user_badges[]          @relation("UserBadges")
  schedules            user_schedules[]       @relation("UserSchedules")
  weekly_hours_history weekly_hours_history[] @relation("UserWeeklyHoursHistory")
  weekly_reports       weekly_reports[]       @relation("UserWeeklyReports")
  work_sessions        work_sessions[]        @relation("UserWorkSessions")
  notifications        notifications[]        @relation("UserNotifications")
}

model projects {
  id          Int               @id @default(autoincrement())
  name        String
  description String?
  createdAt   String
  createdBy   Int
  leaderId    Int?
  status      String
  links       Json?
  daily_logs  daily_logs[]      @relation("ProjectDailyLogs")
  members     project_members[] @relation("ProjectMemberships")
  creator     users             @relation("UserProjects", fields: [createdBy], references: [id])
  leader      users?            @relation("UserProjectLeadership", fields: [leaderId], references: [id])
  tasks       tasks[]           @relation("ProjectTasks")
  work_sessions work_sessions[] @relation("WorkSessionProject")
}

model project_members {
  id        Int        @id @default(autoincrement())
  projectId Int
  userId    Int
  joinedAt  DateTime   @default(now())
  roles     UserRole[]
  project   projects   @relation("ProjectMemberships", fields: [projectId], references: [id], onDelete: Cascade)
  user      users      @relation("UserProjectMemberships", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([projectId, userId])
}

model tasks {
  id             Int       @id @default(autoincrement())
  title          String
  description    String?
  status         String
  priority       String
  assignedTo     Int?
  projectId      Int?
  dueDate        String?
  points         Int       @default(0)
  completed      Boolean   @default(false)
  taskVisibility String    @default("delegated")
  isGlobal       Boolean   @default(false)
  assignee       users?    @relation("UserTasks", fields: [assignedTo], references: [id])
  projectObj     projects? @relation("ProjectTasks", fields: [projectId], references: [id])
}

model rewards {
  id          Int         @id @default(autoincrement())
  name        String
  description String?
  price       Int
  available   Boolean     @default(true)
  purchases   purchases[] @relation("RewardPurchases")
}

model purchases {
  id           Int     @id @default(autoincrement())
  userId       Int
  rewardId     Int
  rewardName   String
  price        Int
  purchaseDate String
  status       String
  reward       rewards @relation("RewardPurchases", fields: [rewardId], references: [id])
  user         users   @relation("UserPurchases", fields: [userId], references: [id])
}

model lab_responsibilities {
  id        Int     @id @default(autoincrement())
  userId    Int
  userName  String
  startTime String
  endTime   String?
  notes     String?
  user      users   @relation("UserLabResponsibilities", fields: [userId], references: [id])
}

model daily_logs {
  id            Int            @id @default(autoincrement())
  userId        Int
  projectId     Int?
  date          DateTime
  note          String?
  createdAt     DateTime       @default(now())
  workSessionId Int?           @unique
  project       projects?      @relation("ProjectDailyLogs", fields: [projectId], references: [id])
  user          users          @relation("UserDailyLogs", fields: [userId], references: [id])
  workSession   work_sessions? @relation("WorkSessionDailyLog", fields: [workSessionId], references: [id], onDelete: Cascade)
}

model weekly_reports {
  id        Int      @id @default(autoincrement())
  userId    Int
  userName  String
  weekStart DateTime
  weekEnd   DateTime
  totalLogs Int      @default(0)
  summary   String?
  createdAt DateTime @default(now())
  user      users    @relation("UserWeeklyReports", fields: [userId], references: [id])
}

model user_schedules {
  id        Int      @id @default(autoincrement())
  userId    Int
  dayOfWeek Int
  startTime String
  endTime   String
  createdAt DateTime @default(now())
  user      users    @relation("UserSchedules", fields: [userId], references: [id])
}

model laboratory_schedules {
  id        Int      @id @default(autoincrement())
  dayOfWeek Int
  startTime String
  endTime   String
  notes     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model history {
  id          Int      @id @default(autoincrement())
  entityType  String
  entityId    Int
  action      String
  performedBy Int
  performedAt DateTime @default(now())
  oldValues   Json?
  newValues   Json?
  description String?
  metadata    Json?
  performer   users    @relation("UserHistory", fields: [performedBy], references: [id])

  @@index([entityType, entityId])
  @@index([performedBy])
  @@index([performedAt])
  @@index([action])
}

model work_sessions {
  id        Int         @id @default(autoincrement())
  userId    Int
  userName  String
  startTime DateTime    @default(now())
  endTime   DateTime?
  duration  Float?
  activity  String?
  location  String?
  projectId Int?
  status    String      @default("active")
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  dailyLog  daily_logs? @relation("WorkSessionDailyLog")
  user      users       @relation("UserWorkSessions", fields: [userId], references: [id], onDelete: Cascade)
  project   projects?   @relation("WorkSessionProject", fields: [projectId], references: [id])
}

model kanban_boards {
  id        Int      @id @default(autoincrement())
  name      String
  labId     Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model lab_events {
  id        Int      @id @default(autoincrement())
  userId    Int
  userName  String
  date      DateTime
  note      String
  createdAt DateTime @default(now())
  user      users    @relation("UserLabEvents", fields: [userId], references: [id])
}

model weekly_hours_history {
  id         Int      @id @default(autoincrement())
  userId     Int
  userName   String
  weekStart  DateTime
  weekEnd    DateTime
  totalHours Float
  createdAt  DateTime @default(now())
  user       users    @relation("UserWeeklyHoursHistory", fields: [userId], references: [id], onDelete: Cascade)
}

model badges {
  id          Int           @id @default(autoincrement())
  name        String
  description String
  icon        String?
  color       String?
  category    BadgeCategory
  criteria    Json?
  isActive    Boolean       @default(true)
  createdAt   DateTime      @default(now())
  createdBy   Int
  creator     users         @relation("UserCreatedBadges", fields: [createdBy], references: [id])
  userBadges  user_badges[] @relation("BadgeUserBadges")
}

model user_badges {
  id       Int      @id @default(autoincrement())
  userId   Int
  badgeId  Int
  earnedAt DateTime @default(now())
  earnedBy Int?
  badge    badges   @relation("BadgeUserBadges", fields: [badgeId], references: [id], onDelete: Cascade)
  awarder  users?   @relation("UserAwardedBadges", fields: [earnedBy], references: [id])
  user     users    @relation("UserBadges", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, badgeId])
}

model issues {
  id          Int           @id @default(autoincrement())
  title       String
  description String
  status      IssueStatus   @default(open)
  priority    IssuePriority @default(medium)
  category    String?
  reporterId  Int
  assigneeId  Int?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  resolvedAt  DateTime?
  assignee    users?        @relation("UserAssignedIssues", fields: [assigneeId], references: [id])
  reporter    users         @relation("UserReportedIssues", fields: [reporterId], references: [id])
}

enum UserRole {
  COORDENADOR
  GERENTE
  LABORATORISTA
  PESQUISADOR
  GERENTE_PROJETO
  COLABORADOR
  VOLUNTARIO
}

enum ProfileVisibility {
  public
  members_only
  private
}

enum BadgeCategory {
  achievement
  milestone
  special
  social
}

enum IssueStatus {
  open
  in_progress
  resolved
  closed
}

enum IssuePriority {
  low
  medium
  high
  urgent
}

model notifications {
  id        Int       @id @default(autoincrement())
  userId    Int
  type      String
  title     String
  message   String
  data      String?   // JSON data
  read      Boolean   @default(false)
  createdAt DateTime  @default(now())
  readAt    DateTime?
  
  user      users     @relation("UserNotifications", fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("notifications")
}

